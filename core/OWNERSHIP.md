# Three-Layer Ownership Model

How Engram files are classified and updated.

## Layer 1: CORE-OWNED

Source of truth: `core/`. Updated by `update.sh` (always overwritten).

| Path in core/ | Installed to .claude/ |
|---|---|
| `core/commands/*.md` | `.claude/commands/*.md` |
| `core/dna/*.md` | `.claude/dna/*.md` |
| `core/genesis/SKILL.md` | `.claude/skills/engram-genesis/SKILL.md` |
| `core/genesis/scripts/*.py` | `.claude/skills/engram-genesis/scripts/*.py` |
| `core/genesis/references/*` | `.claude/skills/engram-genesis/references/*` |
| `core/evolution/SKILL.md` | `.claude/skills/engram-evolution/SKILL.md` |
| `core/evolution/scripts/*.py` | `.claude/skills/engram-evolution/scripts/*.py` |
| `core/seeds/*/SKILL.md` | `.claude/skills/*/SKILL.md` |
| `.claude/brain/*.py` (source repo) | `.claude/brain/*.py` (target) |
| `.claude/brain/*.sh` (source repo) | `.claude/brain/*.sh` (target) |

## Layer 2: PROJECT-OWNED

Source of truth: `.claude/` in the target project. Never overwritten by updates.

| Path | Notes |
|---|---|
| `.claude/agents/*.md` | Generated by `/init-engram`, customized per project |
| `.claude/skills/*` (non-seed) | Skills generated by genesis or runtime |
| `.claude/knowledge/` | Project knowledge files |
| `CLAUDE.md` | Project-specific instructions |
| `.claude/settings.json` | Project permissions |

## Layer 3: RUNTIME

Generated during use. Never in `core/`, never overwritten.

| Path | Notes |
|---|---|
| `.claude/brain/brain.db` | Knowledge graph data |
| `.claude/brain/.venv/` | Python virtual environment |
| `.claude/brain/state/` | Brain state files |
| `.claude/brain/*.jsonl` | Sleep logs, activation logs |
| `.claude/manifest.json` | Component registry |
| `.claude/evolution-activations.json` | Usage tracking |

## Update Behavior

```
./update.sh [TARGET_DIR]          # Update with drift report
./update.sh --check [TARGET_DIR]  # Report drift only (exit 0=ok, 1=drift)
./update.sh --force [TARGET_DIR]  # Skip confirmation
./update.sh --regenerate [...]    # Also regenerate CLAUDE.md
```

`setup.sh --update` delegates to `update.sh`.

## Self-Hosted Mode

When Engram is installed on itself (`setup.sh .`), improvements to `.claude/` during
sessions should be propagated back to `core/` manually:

1. `./update.sh --check .` to see what drifted
2. Review diffs and decide direction (core/ wins or .claude/ wins)
3. Apply changes to `core/` if universal, or keep in `.claude/` if project-specific
